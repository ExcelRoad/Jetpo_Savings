{% extends "base.html" %}
{% load static %}

{% block title %}הפרופיל שלי - Jetpo{% endblock %}

{% block content %}
<div class="max-w-4xl mx-auto px-4 py-12">
    <!-- Header -->
    <div class="mb-8">
        <h1 class="text-3xl font-bold text-gray-900 mb-2">הפרופיל שלי</h1>
        <p class="text-gray-600">נהל את פרטי החשבון והעדפות שלך</p>
    </div>

    <!-- Profile Picture Section -->
    <div class="bg-white border border-gray-100 rounded-lg p-8 mb-6">
        <h2 class="text-xl font-semibold text-gray-900 mb-6">תמונת פרופיל</h2>
        <form method="post" action="{% url 'profile_update' %}" enctype="multipart/form-data" class="flex items-start gap-6">
            {% csrf_token %}
            <div class="flex-shrink-0">
                {% if user.profile_picture %}
                    <img src="{{ user.profile_picture.url }}" alt="תמונת פרופיל" class="w-24 h-24 rounded-full object-cover border-2 border-gray-100">
                {% else %}
                    <div class="w-24 h-24 rounded-full bg-gray-100 flex items-center justify-center border-2 border-gray-100">
                        <svg class="w-12 h-12 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
                        </svg>
                    </div>
                {% endif %}
            </div>
            <div class="flex-grow">
                <input type="hidden" name="form_type" value="profile">
                {{ profile_form.profile_picture }}
                <p class="text-sm text-gray-500 mt-2">JPG, PNG או GIF. מקסימום 5MB.</p>
                <button type="submit" class="mt-4 px-4 py-2 bg-gray-900 text-white text-sm rounded-lg hover:bg-gray-800 transition-colors">
                    עדכן תמונה
                </button>
            </div>
        </form>
    </div>

    <!-- Personal Information Section -->
    <div class="bg-white border border-gray-100 rounded-lg p-8 mb-6">
        <h2 class="text-xl font-semibold text-gray-900 mb-6">פרטים אישיים</h2>
        <form method="post" action="{% url 'profile_update' %}" class="space-y-4">
            {% csrf_token %}
            <input type="hidden" name="form_type" value="profile">

            <div>
                <label for="{{ profile_form.first_name.id_for_label }}" class="block text-sm font-medium text-gray-700 mb-2">
                    שם פרטי
                </label>
                {{ profile_form.first_name }}
            </div>

            <div>
                <label for="{{ profile_form.last_name.id_for_label }}" class="block text-sm font-medium text-gray-700 mb-2">
                    שם משפחה
                </label>
                {{ profile_form.last_name }}
            </div>

            <button type="submit" class="px-4 py-2 bg-gray-900 text-white text-sm rounded-lg hover:bg-gray-800 transition-colors">
                שמור שינויים
            </button>
        </form>
    </div>

    <!-- Email Section -->
    <div class="bg-white border border-gray-100 rounded-lg p-8 mb-6">
        <h2 class="text-xl font-semibold text-gray-900 mb-6">כתובת אימייל</h2>
        <form method="post" action="{% url 'email_update' %}" class="space-y-4">
            {% csrf_token %}

            <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">
                    אימייל נוכחי
                </label>
                <p class="text-gray-900">{{ user.email }}</p>
            </div>

            <div>
                <label for="{{ email_form.new_email.id_for_label }}" class="block text-sm font-medium text-gray-700 mb-2">
                    אימייל חדש
                </label>
                {{ email_form.new_email }}
            </div>

            <div>
                <label for="{{ email_form.confirm_email.id_for_label }}" class="block text-sm font-medium text-gray-700 mb-2">
                    אימות אימייל
                </label>
                {{ email_form.confirm_email }}
            </div>

            <p class="text-sm text-gray-500">
                <svg class="inline w-4 h-4 ml-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                </svg>
                שינוי האימייל ישפיע על אופן ההתחברות שלך למערכת
            </p>

            <button type="submit" class="px-4 py-2 bg-gray-900 text-white text-sm rounded-lg hover:bg-gray-800 transition-colors">
                עדכן אימייל
            </button>
        </form>
    </div>

    <!-- Password Section -->
    <div class="bg-white border border-gray-100 rounded-lg p-8 mb-6">
        <h2 class="text-xl font-semibold text-gray-900 mb-6">סיסמה</h2>
        <form method="post" action="{% url 'password_change' %}" class="space-y-4">
            {% csrf_token %}

            <div>
                <label for="{{ password_form.old_password.id_for_label }}" class="block text-sm font-medium text-gray-700 mb-2">
                    סיסמה נוכחית
                </label>
                {{ password_form.old_password }}
            </div>

            <div>
                <label for="{{ password_form.new_password1.id_for_label }}" class="block text-sm font-medium text-gray-700 mb-2">
                    סיסמה חדשה
                </label>
                {{ password_form.new_password1 }}
            </div>

            <div>
                <label for="{{ password_form.new_password2.id_for_label }}" class="block text-sm font-medium text-gray-700 mb-2">
                    אימות סיסמה חדשה
                </label>
                {{ password_form.new_password2 }}
            </div>

            <p class="text-sm text-gray-500">
                הסיסמה חייבת להכיל לפחות 8 תווים ולא יכולה להיות סיסמה נפוצה
            </p>

            <button type="submit" class="px-4 py-2 bg-gray-900 text-white text-sm rounded-lg hover:bg-gray-800 transition-colors">
                שנה סיסמה
            </button>
        </form>
    </div>

    <!-- Account Information -->
    <div class="bg-white border border-gray-100 rounded-lg p-8 mb-6">
        <h2 class="text-xl font-semibold text-gray-900 mb-6">מידע על החשבון</h2>
        <div class="space-y-4">
            <div class="flex justify-between py-3 border-b border-gray-50">
                <span class="text-gray-600">תאריך הצטרפות</span>
                <span class="text-gray-900">{{ user.date_joined|date:"d/m/Y" }}</span>
            </div>
            <div class="flex justify-between py-3 border-b border-gray-50">
                <span class="text-gray-600">סוג משתמש</span>
                <span class="text-gray-900">{{ user.get_user_type_display }}</span>
            </div>
            <div class="flex justify-between py-3">
                <span class="text-gray-600">התחברות אחרונה</span>
                <span class="text-gray-900">{{ user.last_login|date:"d/m/Y H:i" }}</span>
            </div>
        </div>
    </div>

    <!-- Submitted Articles Section -->
    <div class="bg-white border border-gray-100 rounded-lg p-8 mb-6">
        <div class="flex items-center justify-between mb-6">
            <h2 class="text-xl font-semibold text-gray-900">המאמרים שלי</h2>
            <a href="{% url 'submit_article' %}" class="btn btn-primary text-sm">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-4 h-4">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M12 4.5v15m7.5-7.5h-15" />
                </svg>
                הגש מאמר חדש
            </a>
        </div>

        {% if user.article_submissions.all %}
            <div class="space-y-4">
                {% for submission in user.article_submissions.all %}
                    <div class="border border-gray-200 rounded-lg p-4">
                        <div class="flex items-start justify-between mb-3">
                            <div class="flex-1">
                                <h3 class="font-semibold text-gray-900 mb-1">{{ submission.title }}</h3>
                                <p class="text-sm text-gray-600">{{ submission.excerpt|truncatewords:20 }}</p>
                            </div>
                            <span class="px-3 py-1 rounded-full text-xs font-medium whitespace-nowrap mr-4
                                {% if submission.review_status == 'PENDING' %}bg-yellow-100 text-yellow-800
                                {% elif submission.review_status == 'APPROVED' %}bg-green-100 text-green-800
                                {% elif submission.review_status == 'DECLINED' %}bg-red-100 text-red-800
                                {% endif %}">
                                {{ submission.get_review_status_display }}
                            </span>
                        </div>

                        <div class="flex items-center gap-4 text-xs text-gray-500 mb-3">
                            <span>הוגש: {{ submission.submitted_at|date:"d/m/Y" }}</span>
                            {% if submission.reviewed_at %}
                                <span>נבדק: {{ submission.reviewed_at|date:"d/m/Y" }}</span>
                            {% endif %}
                            <span>{{ submission.get_expertise_type_display }}</span>
                        </div>

                        {% if submission.review_status == 'DECLINED' and submission.decline_reason %}
                            <div class="bg-red-50 border border-red-200 rounded-lg p-3">
                                <div class="flex items-start gap-2">
                                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5 text-red-600 flex-shrink-0">
                                        <path stroke-linecap="round" stroke-linejoin="round" d="M12 9v3.75m9-.75a9 9 0 1 1-18 0 9 9 0 0 1 18 0Zm-9 3.75h.008v.008H12v-.008Z" />
                                    </svg>
                                    <div>
                                        <p class="text-sm font-medium text-red-800 mb-1">סיבת הדחייה:</p>
                                        <p class="text-sm text-red-700">{{ submission.decline_reason }}</p>
                                    </div>
                                </div>
                            </div>
                        {% endif %}

                        {% if submission.review_status == 'APPROVED' and submission.approved_article %}
                            <a href="{% url 'article_detail' submission.approved_article.slug %}" class="inline-flex items-center gap-2 text-sm text-primary-600 hover:text-primary-700">
                                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-4 h-4">
                                    <path stroke-linecap="round" stroke-linejoin="round" d="M13.5 6H5.25A2.25 2.25 0 0 0 3 8.25v10.5A2.25 2.25 0 0 0 5.25 21h10.5A2.25 2.25 0 0 0 18 18.75V10.5m-10.5 6L21 3m0 0h-5.25M21 3v5.25" />
                                </svg>
                                צפה במאמר המפורסם
                            </a>
                        {% endif %}
                    </div>
                {% endfor %}
            </div>
        {% else %}
            <div class="text-center py-8 text-gray-500">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-12 h-12 mx-auto mb-3 opacity-50">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M19.5 14.25v-2.625a3.375 3.375 0 0 0-3.375-3.375h-1.5A1.125 1.125 0 0 1 13.5 7.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H8.25m0 12.75h7.5m-7.5 3H12M10.5 2.25H5.625c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125V11.25a9 9 0 0 0-9-9Z" />
                </svg>
                <p>עדיין לא הגשת מאמרים</p>
                <p class="text-sm mt-2">שתף את הידע שלך עם הקהילה</p>
            </div>
        {% endif %}
    </div>

    <!-- Danger Zone -->
    <div class="bg-white border border-red-100 rounded-lg p-8">
        <h2 class="text-xl font-semibold text-red-600 mb-4">אזור סכנה</h2>
        <p class="text-gray-600 mb-4">מחיקת החשבון היא פעולה בלתי הפיכה. כל הנתונים שלך יימחקו לצמיתות.</p>
        <button class="px-4 py-2 bg-white border border-red-200 text-red-600 text-sm rounded-lg hover:bg-red-50 transition-colors">
            מחק חשבון
        </button>
    </div>
</div>
{% endblock %}
